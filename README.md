# landscape inference from sequence data

This repository contains the Python code for fitness landscape inference, validation and visualization used in our manuscript on a heterogeneously epistatic antibody fitness landscape promoting evolvability. It reproduces the plots shown in Figs. 1, S3 and S4.

## Contents

| file/directory      | description       |
|----------------|----------------|
| [`data`](data/) | sequence count data reported out of the experiment (see [this Github repo](https://github.com/nicwulab/COV107-23_fitness_landscape)) |
| [`output`](output/) | output data and plots generated by the Jupyter scripts below |
| [`src`](src/) | some functions I wrote (e.g. for landscape class, Eq. (1), Î³ statistics, etc.) |
| [`fig1B.ipynb`](fig1B.ipynb) | global epistasis model for sequence count data using maximum-likelihood estimation |
| [`fig1C.ipynb`](fig1C.ipynb) | specific epistasis model for sequence count data using maximum-likelihood estimation |
| [`fig1D_S4AB.ipynb`](fig1D_S4AB.ipynb) | low-dimensional visualization of fitness landscape using force-directed network layout |
| [`fig1E.ipynb`](fig1E.ipynb) | low-dimensional and comparable visualization of fitness (sub-) landscapes using force-directed network layout |
| [`figS3A.ipynb`](figS3A.ipynb) | validation of specific epistasis models obtained from maximum-likelihood estimation (using cross-validation) and from Walsh-Hadamard transform (using bandpass filters) |

## Dependencies

- [`pandas`](https://pandas.pydata.org/)
- [`NumPy`](https://numpy.org/)
- [`SciPy`](https://scipy.org/)
- [`igraph`](https://igraph.org/)
- [`random`](https://docs.python.org/fr/3/library/random.html)
- [`sparray`](https://github.com/jesolem/sparray)
- [`SymPy`](https://www.sympy.org/en/index.html)
- [`mavenn`](https://github.com/jbkinney/mavenn)
- [`Matplotlib`](https://matplotlib.org/)

Some dependencies are tricky to get installed. Below is the code I used to build a conda environment that did the job for me:
```
conda create --name <your_env_name>
conda activate <your_env_name>
conda install python==3.7.2
pip install tensorflow
pip install mavenn
pip install notebook
pip install python-igraph
pip install sympy
```

A spec file ([exact build](ucla_landscape.txt) or [yml](ucla_landscape.yml)) for this environment is also included. These can be installed using
```
conda create --name <your_env_name> --file ucla_landscape.txt
```
or
```
conda env create -f ucla_landscape.yml
```

## Code references

Some of the code here is borrowed from elsewhere:

- [code from here](https://github.com/mfazampour/medphys_ct_us_registration/blob/master/spine_flownet/rigid_transform_3D-master/rigid_transform_3D.py): used to find the best match between two point clouds